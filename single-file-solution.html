<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Dataset Platform</title>
    
    <!-- Transformers.js and TensorFlow.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0"></script>
    
    <style>
        /* CSS Variables */
        :root {
            --primary-color: #4285f4;
            --primary-dark: #3367d6;
            --secondary-color: #f8f9fa;
            --text-color: #202124;
            --light-text: #5f6368;
            --border-color: #dadce0;
            --success-color: #34a853;
            --warning-color: #fbbc05;
            --error-color: #ea4335;
            --box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--secondary-color);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .hidden {
            display: none !important;
        }

        h1, h2, h3 {
            margin-bottom: 1rem;
            font-weight: 600;
        }

        h1 {
            font-size: 2.2rem;
        }

        h2 {
            font-size: 1.8rem;
        }

        h3 {
            font-size: 1.4rem;
        }

        p {
            margin-bottom: 1rem;
        }

        button {
            display: inline-block;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: #e8eaed;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        input, textarea {
            width: 100%;
            padding: 10px 15px;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }

        /* Header */
        header {
            background-color: white;
            box-shadow: var(--box-shadow);
            padding: 1rem 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Navigation */
        nav {
            background-color: white;
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-right: 20px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            padding: 10px 0;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-links a.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Login/Register */
        .auth-container {
            max-width: 400px;
            margin: 3rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .auth-tab {
            flex: 1;
            background: none;
            border: none;
            padding: 10px 0;
            font-size: 1rem;
            font-weight: 500;
            color: var(--light-text);
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .auth-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Dashboard */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .datasets-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .dataset-card {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: white;
        }

        .dataset-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .dataset-meta {
            font-size: 0.9rem;
            color: var(--light-text);
        }

        .dataset-actions {
            margin-top: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 0;
            color: var(--light-text);
        }

        /* Upload Section */
        .upload-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .drop-zone:hover, .drop-zone.highlight {
            border-color: var(--primary-color);
            background-color: rgba(66, 133, 244, 0.04);
        }

        .file-preview {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        /* Analysis */
        .analysis-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .progress-container {
            width: 100%;
            height: 8px;
            background-color: var(--secondary-color);
            border-radius: 4px;
            margin: 1.5rem 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .results-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .results-tab {
            padding: 10px 15px;
            background: none;
            border: none;
            font-weight: 500;
            color: var(--light-text);
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .results-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .result-section {
            margin-bottom: 1.5rem;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--light-text);
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 0;
        }

        .text-preview {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            font-family: monospace;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content, .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .nav-container {
                flex-direction: column;
            }
            
            .nav-links {
                margin-top: 1rem;
                width: 100%;
                justify-content: space-between;
            }
            
            .nav-links li {
                margin-right: 0;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1>Academic Dataset Platform</h1>
                <div id="user-info" class="hidden">
                    <span id="username-display"></span>
                    <button id="logout-btn" class="btn-secondary">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-container">
                <ul class="nav-links">
                    <li><a href="#" id="nav-dashboard" class="active">Dashboard</a></li>
                    <li><a href="#" id="nav-upload">Upload Dataset</a></li>
                </ul>
                <div id="usage-counter">
                    <span id="usage-count">0</span>/20 uploads today
                </div>
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- Auth Section -->
        <section id="auth-section">
            <div class="auth-container">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">Login</button>
                    <button class="auth-tab" data-tab="register">Register</button>
                </div>
                
                <div id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="Enter your password">
                    </div>
                    <button id="login-btn" class="btn-primary">Login</button>
                    <p id="login-error" class="error-message"></p>
                </div>
                
                <div id="register-form" class="hidden">
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" placeholder="Create a password">
                    </div>
                    <button id="register-btn" class="btn-primary">Register</button>
                    <p id="register-error" class="error-message"></p>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard-section" class="hidden">
            <div class="dashboard-header">
                <h2>My Datasets</h2>
                <button id="new-upload-btn" class="btn-primary">Upload New Dataset</button>
            </div>
            
            <div class="datasets-container">
                <div id="datasets-list">
                    <!-- Datasets will be loaded here -->
                </div>
                <div id="empty-state" class="empty-state hidden">
                    <h3>No datasets yet</h3>
                    <p>Upload your first dataset to start analyzing academic data</p>
                    <button id="first-upload-btn" class="btn-primary">Upload Dataset</button>
                </div>
            </div>
        </section>

        <!-- Upload Section -->
        <section id="upload-section" class="hidden">
            <h2>Upload Dataset</h2>
            <div class="upload-container">
                <div class="form-group">
                    <label for="dataset-name">Dataset Name</label>
                    <input type="text" id="dataset-name" placeholder="Enter a name for your dataset">
                </div>
                
                <div class="form-group">
                    <label for="dataset-description">Description (optional)</label>
                    <textarea id="dataset-description" rows="3" placeholder="Provide a brief description of your dataset"></textarea>
                </div>
                
                <div id="drop-zone" class="drop-zone">
                    <p>Drag and drop your file here or click to browse</p>
                    <p style="font-size: 0.9rem; color: var(--light-text);">Supported formats: .txt, .csv, .json (Max: 5MB)</p>
                    <input type="file" id="file-input" accept=".txt,.csv,.json" hidden>
                </div>
                
                <div id="file-preview" class="file-preview hidden">
                    <div>
                        <h4 id="file-name">filename.txt</h4>
                        <p id="file-size" class="dataset-meta">0 KB</p>
                    </div>
                    <button id="remove-file-btn" class="btn-secondary">Remove</button>
                </div>
                
                <div class="form-actions">
                    <button id="cancel-upload-btn" class="btn-secondary">Cancel</button>
                    <button id="analyze-btn" class="btn-primary" disabled>Analyze Dataset</button>
                </div>
            </div>
        </section>

        <!-- Analysis Section -->
        <section id="analysis-section" class="hidden">
            <h2 id="analysis-title">Analyzing Dataset</h2>
            <div class="analysis-container">
                <div id="loading-view">
                    <p id="loading-message">Loading AI model...</p>
                    <div class="progress-container">
                        <div id="analysis-progress" class="progress-bar"></div>
                    </div>
                    <p style="text-align: center; color: var(--light-text);">This may take a moment. Analysis is performed directly in your browser.</p>
                </div>
                
                <div id="results-view" class="hidden">
                    <div class="results-tabs">
                        <button class="results-tab active" data-tab="summary">Summary</button>
                        <button class="results-tab" data-tab="sentiment">Sentiment</button>
                        <button class="results-tab" data-tab="keywords">Keywords</button>
                    </div>
                    
                    <div id="summary-tab" class="result-section">
                        <div class="stats-container">
                            <div class="stat-card">
                                <h3>Document Length</h3>
                                <p id="doc-length">0 characters</p>
                            </div>
                            <div class="stat-card">
                                <h3>Word Count</h3>
                                <p id="word-count">0 words</p>
                            </div>
                            <div class="stat-card">
                                <h3>Average Sentiment</h3>
                                <p id="avg-sentiment">Neutral</p>
                            </div>
                        </div>
                        
                        <h3>Text Preview</h3>
                        <div id="text-preview" class="text-preview"></div>
                    </div>
                    
                    <div id="sentiment-tab" class="result-section hidden">
                        <h3>Sentiment Analysis</h3>
                        <div class="stats-container">
                            <div class="stat-card" style="background-color: rgba(52, 168, 83, 0.1);">
                                <h3>Positive</h3>
                                <p id="positive-score">0%</p>
                            </div>
                            <div class="stat-card" style="background-color: rgba(251, 188, 5, 0.1);">
                                <h3>Neutral</h3>
                                <p id="neutral-score">0%</p>
                            </div>
                            <div class="stat-card" style="background-color: rgba(234, 67, 53, 0.1);">
                                <h3>Negative</h3>
                                <p id="negative-score">0%</p>
                            </div>
                        </div>
                        <div id="sentiment-bars"></div>
                    </div>
                    
                    <div id="keywords-tab" class="result-section hidden">
                        <h3>Top Keywords</h3>
                        <div id="keywords-list"></div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="back-btn" class="btn-secondary">Back to Upload</button>
                        <button id="save-dataset-btn" class="btn-primary">Save Dataset</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Main App Controller
        const App = {
            // Current application state
            state: {
                currentSection: 'auth',
                user: null,
                isAuthenticated: false,
                usageCount: 0,
                usageLimit: 20,
                currentFile: null,
                fileContent: '',
                datasets: [],
                analysisResults: null,
                currentTab: 'summary',
                modelLoaded: false,
                pipeline: null
            },
            
            // Initialize the application
            init() {
                // Check if user is already logged in
                const savedUser = localStorage.getItem('user');
                if (savedUser) {
                    try {
                        this.state.user = JSON.parse(savedUser);
                        this.state.isAuthenticated = true;
                        this.loadUserData();
                    } catch(e) {
                        console.error('Error parsing saved user data:', e);
                        localStorage.removeItem('user');
                    }
                }
                
                // Set up event listeners
                this.setupEventListeners();
                
                // Show the appropriate section
                this.updateUI();
            },
            
            // Set up all event listeners
            setupEventListeners() {
                // Auth tabs
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.dataset.tab;
                        document.querySelectorAll('.auth-tab').forEach(t => {
                            t.classList.toggle('active', t.dataset.tab === tabName);
                        });
                        
                        document.getElementById('login-form').classList.toggle('hidden', tabName !== 'login');
                        document.getElementById('register-form').classList.toggle('hidden', tabName !== 'register');
                    });
                });
                
                // Login button
                document.getElementById('login-btn').addEventListener('click', () => {
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    this.login(email, password);
                });
                
                // Register button
                document.getElementById('register-btn').addEventListener('click', () => {
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    this.register(email, password);
                });
                
                // Logout button
                document.getElementById('logout-btn').addEventListener('click', () => {
                    this.logout();
                });
                
                // Navigation links
                document.getElementById('nav-dashboard').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.navigateTo('dashboard');
                });
                
                document.getElementById('nav-upload').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.navigateTo('upload');
                });
                
                // Upload new dataset buttons
                document.getElementById('new-upload-btn').addEventListener('click', () => {
                    this.navigateTo('upload');
                });
                
                document.getElementById('first-upload-btn').addEventListener('click', () => {
                    this.navigateTo('upload');
                });
                
                // File drop zone
                const dropZone = document.getElementById('drop-zone');
                dropZone.addEventListener('click', () => {
                    document.getElementById('file-input').click();
                });
                
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, preventDefaults, false);
                });
                
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, unhighlight, false);
                });
                
                dropZone.addEventListener('drop', handleDrop, false);
                
                // File input
                document.getElementById('file-input').addEventListener('change', (e) => {
                    const files = e.target.files;
                    if (files.length > 0) {
                        this.handleFile(files[0]);
                    }
                });
                
                // Remove file button
                document.getElementById('remove-file-btn').addEventListener('click', () => {
                    this.removeFile();
                });
                
                // Cancel upload button
                document.getElementById('cancel-upload-btn').addEventListener('click', () => {
                    this.navigateTo('dashboard');
                });
                
                // Analyze button
                document.getElementById('analyze-btn').addEventListener('click', () => {
                    this.startAnalysis();
                });
                
                // Back button in analysis
                document.getElementById('back-btn').addEventListener('click', () => {
                    this.navigateTo('upload');
                });
                
                // Save dataset button
                document.getElementById('save-dataset-btn').addEventListener('click', () => {
                    this.saveDataset();
                });
                
                // Results tabs
                document.querySelectorAll('.results-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.dataset.tab;
                        this.switchResultTab(tabName);
                    });
                });
                
                // Helper functions for drag & drop
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                function highlight() {
                    dropZone.classList.add('highlight');
                }
                
                function unhighlight() {
                    dropZone.classList.remove('highlight');
                }
                
                const app = this;
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    if (files.length > 0) {
                        app.handleFile(files[0]);
                    }
                }
            },
            
            // Handle file selection
            handleFile(file) {
                // Check file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size exceeds 5MB limit');
                    return;
                }
                
                // Check file type
                const acceptedTypes = ['.txt', '.csv', '.json'];
                const fileExt = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
                if (!acceptedTypes.includes(fileExt)) {
                    alert('Only TXT, CSV, and JSON files are supported');
                    return;
                }
                
                // Save the file in state
                this.state.currentFile = file;
                
                // Update UI
                document.getElementById('file-name').textContent = file.name;
                document.getElementById('file-size').textContent = this.formatFileSize(file.size);
                document.getElementById('file-preview').classList.remove('hidden');
                document.getElementById('analyze-btn').disabled = false;
            },
            
            // Remove the current file
            removeFile() {
                this.state.currentFile = null;
                document.getElementById('file-input').value = '';
                document.getElementById('file-preview').classList.add('hidden');
                document.getElementById('analyze-btn').disabled = true;
            },
            
            // Format file size
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
            },
            
            // Start the analysis process
            async startAnalysis() {
                if (!this.state.currentFile) return;
                
                // Navigate to analysis section
                this.navigateTo('analysis');
                
                // Show loading view, hide results
                document.getElementById('loading-view').classList.remove('hidden');
                document.getElementById('results-view').classList.add('hidden');
                document.getElementById('analysis-title').textContent = 'Analyzing Dataset';
                
                // Set initial progress
                this.updateProgress(5, 'Reading file...');
                
                try {
                    // Read file content
                    this.state.fileContent = await this.readFileContent(this.state.currentFile);
                    this.updateProgress(20, 'Loading AI model...');
                    
                    // Load model if not already loaded
                    if (!this.state.modelLoaded) {
                        await this.loadModel();
                    }
                    
                    this.updateProgress(60, 'Analyzing text...');
                    
                    // Analyze the text
                    this.state.analysisResults = await this.analyzeText(this.state.fileContent);
                    
                    this.updateProgress(90, 'Preparing results...');
                    
                    // Update results UI
                    this.updateResultsUI();
                    
                    this.updateProgress(100, 'Analysis complete!');
                    
                    // Show results view after a short delay
                    setTimeout(() => {
                        document.getElementById('loading-view').classList.add('hidden');
                        document.getElementById('results-view').classList.remove('hidden');
                        document.getElementById('analysis-title').textContent = 'Analysis Results';
                    }, 500);
                } catch (error) {
                    console.error('Analysis error:', error);
                    this.updateProgress(0, 'Error: ' + error.message);
                }
            },
            
            // Read file content
            readFileContent(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        resolve(event.target.result);
                    };
                    
                    reader.onerror = function(error) {
                        reject(error);
                    };
                    
                    reader.readAsText(file);
                });
            },
            
            // Load Transformers.js model
            async loadModel() {
                try {
                    // Import pipeline from Transformers.js
                    const { pipeline } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0/dist/transformers.min.js');
                    
                    // Load sentiment analysis model
                    this.state.pipeline = await pipeline('sentiment-analysis', 'Xenova/distilbert-base-uncased-finetuned-sst-2-english');
                    this.state.modelLoaded = true;
                    
                    return true;
                } catch (error) {
                    console.error('Error loading model:', error);
                    throw new Error('Failed to load AI model. Please refresh and try again.');
                }
            },
            
            // Update progress indicator
            updateProgress(percent, message) {
                document.getElementById('analysis-progress').style.width = `${percent}%`;
                if (message) {
                    document.getElementById('loading-message').textContent = message;
                }
            },
            
            // Analyze text
            async analyzeText(text) {
                // Basic text statistics
                const characterCount = text.length;
                const wordCount = text.split(/\s+/).filter(word => word.length > 0).length;
                
                // Truncate text if too long (for sentiment analysis)
                const maxLength = 2048;
                const truncatedText = text.length > maxLength ? text.substring(0, maxLength) : text;
                
                // Analyze sentiment
                const sentimentResult = await this.state.pipeline(truncatedText);
                
                // Extract sentiment
                let sentiment = 'Neutral';
                let positive = 0.5;
                let negative = 0.5;
                
                if (sentimentResult && sentimentResult.length > 0) {
                    if (sentimentResult[0].label === 'POSITIVE') {
                        sentiment = 'Positive';
                        positive = sentimentResult[0].score;
                        negative = 1 - positive;
                    } else {
                        sentiment = 'Negative';
                        negative = sentimentResult[0].score;
                        positive = 1 - negative;
                    }
                }
                
                // Extract keywords (simple implementation)
                const keywords = this.extractKeywords(text);
                
                return {
                    characterCount,
                    wordCount,
                    averageSentiment: sentiment,
                    sentimentBreakdown: {
                        positive,
                        negative,
                        neutral: Math.max(0, 1 - (positive + negative))
                    },
                    keywords
                };
            },
            
            // Extract keywords (simplified implementation)
            extractKeywords(text) {
                // Split into words, convert to lowercase
                const words = text.toLowerCase().split(/\W+/).filter(word => word.length > 2);
                
                // Count word frequency
                const wordCounts = {};
                words.forEach(word => {
                    // Skip common words
                    if (this.isStopword(word)) return;
                    
                    wordCounts[word] = (wordCounts[word] || 0) + 1;
                });
                
                // Convert to array and sort by frequency
                const keywords = Object.entries(wordCounts)
                    .map(([text, count]) => ({
                        text,
                        score: count
                    }))
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 20);
                
                return keywords;
            },
            
            // Check if a word is a common stopword
            isStopword(word) {
                const stopwords = new Set([
                    'a', 'an', 'the', 'and', 'or', 'but', 'if', 'then', 'else', 'when',
                    'at', 'from', 'by', 'for', 'with', 'about', 'against', 'between',
                    'into', 'through', 'during', 'before', 'after', 'above', 'below',
                    'to', 'of', 'in', 'on', 'off', 'over', 'under', 'again', 'further',
                    'then', 'once', 'here', 'there', 'where', 'why', 'how', 'all', 'any',
                    'both', 'each', 'few', 'more', 'most', 'other', 'some', 'such', 'no',
                    'nor', 'not', 'only', 'own', 'same', 'so', 'than', 'too', 'very',
                    'can', 'will', 'just', 'don', 'should', 'now'
                ]);
                
                return stopwords.has(word);
            },
            
            // Update results UI
            updateResultsUI() {
                const results = this.state.analysisResults;
                if (!results) return;
                
                // Summary tab
                document.getElementById('doc-length').textContent = `${results.characterCount.toLocaleString()} characters`;
                document.getElementById('word-count').textContent = `${results.wordCount.toLocaleString()} words`;
                document.getElementById('avg-sentiment').textContent = results.averageSentiment;
                
                // Text preview (first 1000 chars)
                const textPreview = this.state.fileContent.substring(0, 1000) + 
                                    (this.state.fileContent.length > 1000 ? '...' : '');
                document.getElementById('text-preview').textContent = textPreview;
                
                // Sentiment tab
                const positive = (results.sentimentBreakdown.positive * 100).toFixed(1);
                const neutral = (results.sentimentBreakdown.neutral * 100).toFixed(1);
                const negative = (results.sentimentBreakdown.negative * 100).toFixed(1);
                
                document.getElementById('positive-score').textContent = `${positive}%`;
                document.getElementById('neutral-score').textContent = `${neutral}%`;
                document.getElementById('negative-score').textContent = `${negative}%`;
                
                // Create sentiment bars
                const sentimentBars = document.getElementById('sentiment-bars');
                sentimentBars.innerHTML = `
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Positive</span>
                            <span>${positive}%</span>
                        </div>
                        <div style="background-color: #eee; border-radius: 4px; height: 20px; overflow: hidden;">
                            <div style="width: ${positive}%; height: 100%; background-color: #34a853;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Neutral</span>
                            <span>${neutral}%</span>
                        </div>
                        <div style="background-color: #eee; border-radius: 4px; height: 20px; overflow: hidden;">
                            <div style="width: ${neutral}%; height: 100%; background-color: #fbbc05;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Negative</span>
                            <span>${negative}%</span>
                        </div>
                        <div style="background-color: #eee; border-radius: 4px; height: 20px; overflow: hidden;">
                            <div style="width: ${negative}%; height: 100%; background-color: #ea4335;"></div>
                        </div>
                    </div>
                `;
                
                // Keywords tab
                const keywordsList = document.getElementById('keywords-list');
                keywordsList.innerHTML = '';
                
                // Create a simple keyword list
                results.keywords.forEach(keyword => {
                    const size = Math.max(14, Math.min(24, 14 + (keyword.score / results.keywords[0].score) * 10));
                    
                    const keywordItem = document.createElement('span');
                    keywordItem.textContent = keyword.text;
                    keywordItem.style.fontSize = `${size}px`;
                    keywordItem.style.display = 'inline-block';
                    keywordItem.style.margin = '5px';
                    keywordItem.style.padding = '5px 10px';
                    keywordItem.style.backgroundColor = '#f0f5ff';
                    keywordItem.style.borderRadius = '20px';
                    
                    keywordsList.appendChild(keywordItem);
                });
            },
            
            // Switch between result tabs
            switchResultTab(tabName) {
                // Update active tab
                document.querySelectorAll('.results-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.tab === tabName);
                });
                
                // Show selected tab content
                document.getElementById('summary-tab').classList.toggle('hidden', tabName !== 'summary');
                document.getElementById('sentiment-tab').classList.toggle('hidden', tabName !== 'sentiment');
                document.getElementById('keywords-tab').classList.toggle('hidden', tabName !== 'keywords');
                
                this.state.currentTab = tabName;
            },
            
            // Save the dataset
            saveDataset() {
                if (!this.state.currentFile || !this.state.fileContent || !this.state.analysisResults) {
                    alert('No dataset to save');
                    return;
                }
                
                // Check usage limit
                if (this.state.usageCount >= this.state.usageLimit) {
                    alert('You have reached your daily upload limit (20)');
                    return;
                }
                
                // Get dataset metadata
                const name = document.getElementById('dataset-name').value.trim() || this.state.currentFile.name;
                const description = document.getElementById('dataset-description').value.trim();
                
                // Create dataset object
                const dataset = {
                    id: 'dataset_' + Date.now(),
                    name,
                    description,
                    fileName: this.state.currentFile.name,
                    fileSize: this.state.currentFile.size,
                    fileType: this.state.currentFile.type || 'text/plain',
                    uploadDate: new Date().toISOString(),
                    analysis: this.state.analysisResults,
                    preview: this.state.fileContent.substring(0, 1000)
                };
                
                // Add to datasets array
                this.state.datasets.push(dataset);
                
                // Increment usage count
                this.state.usageCount++;
                
                // Save to localStorage
                this.saveUserData();
                
                // Navigate to dashboard
                this.navigateTo('dashboard');
                
                // Show success message
                alert('Dataset saved successfully!');
            },
            
            // Register a new user
            register(email, password) {
                // Simple validation
                if (!email || !password) {
                    document.getElementById('register-error').textContent = 'Please enter both email and password';
                    return;
                }
                
                if (password.length < 6) {
                    document.getElementById('register-error').textContent = 'Password must be at least 6 characters';
                    return;
                }
                
                // Check if user already exists
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                if (users.some(user => user.email === email)) {
                    document.getElementById('register-error').textContent = 'Email already registered';
                    return;
                }
                
                // Create user object
                const user = {
                    id: 'user_' + Date.now(),
                    email,
                    // In a real app, you'd use proper password hashing
                    passwordHash: btoa(password),
                    createdAt: new Date().toISOString()
                };
                
                // Save user
                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Set as current user
                this.state.user = user;
                this.state.isAuthenticated = true;
                localStorage.setItem('user', JSON.stringify(user));
                
                // Initialize user data
                this.state.datasets = [];
                this.state.usageCount = 0;
                this.saveUserData();
                
                // Update UI
                this.updateUI();
            },
            
            // Login a user
            login(email, password) {
                // Simple validation
                if (!email || !password) {
                    document.getElementById('login-error').textContent = 'Please enter both email and password';
                    return;
                }
                
                // Check credentials
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.email === email && u.passwordHash === btoa(password));
                
                if (!user) {
                    document.getElementById('login-error').textContent = 'Invalid email or password';
                    return;
                }
                
                // Set as current user
                this.state.user = user;
                this.state.isAuthenticated = true;
                localStorage.setItem('user', JSON.stringify(user));
                
                // Load user data
                this.loadUserData();
                
                // Update UI
                this.updateUI();
            },
            
            // Logout the current user
            logout() {
                this.state.user = null;
                this.state.isAuthenticated = false;
                this.state.datasets = [];
                localStorage.removeItem('user');
                
                // Update UI
                this.updateUI();
            },
            
            // Save user data to localStorage
            saveUserData() {
                if (!this.state.user) return;
                
                const userData = {
                    datasets: this.state.datasets,
                    usageCount: this.state.usageCount,
                    lastReset: new Date().toISOString().split('T')[0]
                };
                
                localStorage.setItem(`userData_${this.state.user.id}`, JSON.stringify(userData));
            },
            
            // Load user data from localStorage
            loadUserData() {
                if (!this.state.user) return;
                
                const userDataString = localStorage.getItem(`userData_${this.state.user.id}`);
                if (!userDataString) {
                    // Initialize empty data
                    this.state.datasets = [];
                    this.state.usageCount = 0;
                    return;
                }
                
                try {
                    const userData = JSON.parse(userDataString);
                    
                    // Check if we need to reset usage count (new day)
                    const today = new Date().toISOString().split('T')[0];
                    if (userData.lastReset !== today) {
                        this.state.usageCount = 0;
                    } else {
                        this.state.usageCount = userData.usageCount || 0;
                    }
                    
                    // Load datasets
                    this.state.datasets = userData.datasets || [];
                } catch(e) {
                    console.error('Error parsing user data:', e);
                    this.state.datasets = [];
                    this.state.usageCount = 0;
                }
            },
            
            // Navigate to a specific section
            navigateTo(section) {
                this.state.currentSection = section;
                this.updateUI();
            },
            
            // Update UI based on current state
            updateUI() {
                // Update navigation links
                document.querySelectorAll('.nav-links a').forEach(link => {
                    if (link.id === `nav-${this.state.currentSection}`) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
                
                // Show/hide sections based on auth state
                if (this.state.isAuthenticated) {
                    // User is logged in
                    document.getElementById('auth-section').classList.add('hidden');
                    document.getElementById('user-info').classList.remove('hidden');
                    document.getElementById('username-display').textContent = this.state.user.email;
                    
                    // Show correct section
                    document.getElementById('dashboard-section').classList.toggle('hidden', this.state.currentSection !== 'dashboard');
                    document.getElementById('upload-section').classList.toggle('hidden', this.state.currentSection !== 'upload');
                    document.getElementById('analysis-section').classList.toggle('hidden', this.state.currentSection !== 'analysis');
                    
                    // Update usage count
                    document.getElementById('usage-count').textContent = this.state.usageCount;
                    
                    // If on dashboard, update dataset list
                    if (this.state.currentSection === 'dashboard') {
                        this.renderDatasetsList();
                    }
                    
                    // If on upload, reset form
                    if (this.state.currentSection === 'upload') {
                        document.getElementById('dataset-name').value = '';
                        document.getElementById('dataset-description').value = '';
                        document.getElementById('file-input').value = '';
                        document.getElementById('file-preview').classList.add('hidden');
                        document.getElementById('analyze-btn').disabled = true;
                        this.state.currentFile = null;
                    }
                } else {
                    // User is not logged in
                    document.getElementById('auth-section').classList.remove('hidden');
                    document.getElementById('user-info').classList.add('hidden');
                    document.getElementById('dashboard-section').classList.add('hidden');
                    document.getElementById('upload-section').classList.add('hidden');
                    document.getElementById('analysis-section').classList.add('hidden');
                }
            },
            
            // Render the datasets list
            renderDatasetsList() {
                const datasetsList = document.getElementById('datasets-list');
                const emptyState = document.getElementById('empty-state');
                
                // Clear the list
                datasetsList.innerHTML = '';
                
                // Check if we have any datasets
                if (this.state.datasets.length === 0) {
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                // Hide empty state
                emptyState.classList.add('hidden');
                
                // Sort datasets by date (newest first)
                const sortedDatasets = [...this.state.datasets].sort((a, b) => 
                    new Date(b.uploadDate) - new Date(a.uploadDate)
                );
                
                // Render each dataset
                sortedDatasets.forEach(dataset => {
                    const datasetCard = document.createElement('div');
                    datasetCard.className = 'dataset-card';
                    
                    const uploadDate = new Date(dataset.uploadDate).toLocaleDateString();
                    const fileSize = this.formatFileSize(dataset.fileSize);
                    
                    datasetCard.innerHTML = `
                        <div class="dataset-header">
                            <h3>${dataset.name}</h3>
                            <span class="dataset-meta">${uploadDate}</span>
                        </div>
                        <p class="dataset-meta">
                            Size: ${fileSize}  
                            Words: ${dataset.analysis.wordCount.toLocaleString()}  
                            Sentiment: ${dataset.analysis.averageSentiment}
                        </p>
                        ${dataset.description ? `<p>${dataset.description}</p>` : ''}
                        <div class="dataset-actions">
                            <button class="btn-primary view-analysis-btn" data-id="${dataset.id}">View Analysis</button>
                            <button class="btn-secondary delete-dataset-btn" data-id="${dataset.id}">Delete</button>
                        </div>
                    `;
                    
                    datasetsList.appendChild(datasetCard);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.view-analysis-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const datasetId = e.target.dataset.id;
                        this.viewDatasetAnalysis(datasetId);
                    });
                });
                
                document.querySelectorAll('.delete-dataset-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const datasetId = e.target.dataset.id;
                        this.deleteDataset(datasetId);
                    });
                });
            },
            
            // View analysis for a dataset
            viewDatasetAnalysis(datasetId) {
                const dataset = this.state.datasets.find(d => d.id === datasetId);
                if (!dataset) return;
                
                // Set current dataset and analysis results
                this.state.fileContent = dataset.preview + '...';
                this.state.analysisResults = dataset.analysis;
                
                // Navigate to analysis section
                this.navigateTo('analysis');
                
                // Update analysis title
                document.getElementById('analysis-title').textContent = `Analysis: ${dataset.name}`;
                
                // Hide loading view, show results
                document.getElementById('loading-view').classList.add('hidden');
                document.getElementById('results-view').classList.remove('hidden');
                
                // Update results UI
                this.updateResultsUI();
                
                // Hide save button
                document.getElementById('save-dataset-btn').classList.add('hidden');
            },
            
            // Delete a dataset
            deleteDataset(datasetId) {
                if (!confirm('Are you sure you want to delete this dataset?')) return;
                
                // Remove from datasets array
                this.state.datasets = this.state.datasets.filter(d => d.id !== datasetId);
                
                // Save updated user data
                this.saveUserData();
                
                // Update UI
                this.renderDatasetsList();
            }
        };

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
    </script>
</body>
</html>
